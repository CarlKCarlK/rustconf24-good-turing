<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Good-Turing Estimation</title>
</head>

<body>
    <h1>Good-Turing Estimation</h1>
    <input type="file" id="fileInput" />
    <p id="lineCount"></p>

    <script type="module">
        import init, { good_turning_js } from './pkg/good_turing.js';

        document.getElementById('fileInput').addEventListener('change', function (event) {
            const file = event.target.files[0];
            if (file) { // If a file was selected
                const reader = new FileReader();
                // What to do when the file is fully read
                reader.onload = async function (e) {
                    await init(); // Ensure 'good_turning_js' is ready
                    // View the memory buffer as a Uint8Array
                    const u8array = new Uint8Array(e.target.result);
                    try {
                        const result = await good_turning_js(u8array);
                        document.getElementById('lineCount').innerHTML =
                            `Prediction (words that appear exactly once on even lines): ${result[0].toLocaleString()}<br>` +
                            `Actual distinct words that appear only on odd lines: ${result[1].toLocaleString()}`;
                    } catch (err) {
                        document.getElementById('lineCount').innerHTML = `Error: ${err}`;
                    }
                };
                // Now start to read the file as memory buffer
                reader.readAsArrayBuffer(file);
            } else {
                document.getElementById('lineCount').innerHTML = '';
            }
        });
    </script>
</body>

</html>